---
title: 权限管理
time: 2019-10-20
category: MySQL
author: 熊滔
---

我们现在默认使用的都是 root 用户：超级管理员，拥有全部的权限。但是一个公司里面的数据库服务器上面可能同时运行着很多个项目的数据库。所以我们应该可以根据不同的项目建立不同的用户，分配不同的权限来管理和维护数据库。

### 创建用户

```sql
CREATE USER '用户名'@'主机名' IDENTIFIED BY '密码'; 
```

- '用户名' 
  - 将创建的用户名 
- '主机名' 
  - 指定该用户在哪个主机上可以登陆，如果是本地用户可用 localhost，如果想让该用户可以 从任意远程主机登陆，可以使用通配符% 
- 该用户的登陆密码，密码可以为空，如果为空则该用户可以不需要密码登陆服务器 

```sql
#创建 user1 用户，只能在 localhost 这个服务器登录 mysql 服务器，密码为 123 
create user 'user1'@'localhost' identified by '123'; 
#创建 user2 用户可以在任何电脑上登录 mysql 服务器，密码为 123 
create user 'user2'@'%' identified by '123'; 
```

创建的用户名都在 mysql 数据库中的 user 表中可以查看到，密码经过了加密。 

### 授予权限

```sql
GRANT 权限 1, 权限 2... ON 数据库名.表名 TO '用户名'@'主机名'; 
```

- `GRANT…ON…TO` 
  - 授权关键字 
- 权限
  - 授予用户的权限，如 `CREATE、ALTER、SELECT、INSERT、UPDATE` 等。如果要授 予所有的权限则使用 `ALL` 
- 数据库名.表名 
  - 该用户可以操作哪个数据库的哪些表。如果要授予该用户对所有数据库和表的相应操作 权限则可用 \* 表示，如 \*.\* 
- '用户名'@'主机名' 
  - 给哪个用户授权

```sql
#给 user1 用户分配对 test 这个数据库操作的权限：创建表，修改表，插入记录，更新记录，查询 
grant create,alter,insert,update,select on test.* to 'user1'@'localhost'; 
 
#给 user2 用户分配所有权限，对所有数据库的所有表  
grant all on *.* to 'user2'@'%'; 
```

### 撤销权限

```sql
REVOKE  权限 1, 权限 2... ON 数据库.表名 from '用户名'@'主机名'; 
```

- `REVOKE…ON…FROM `
  - 撤销授权的关键字 
- 权限 
  - 用户的权限，如 `CREATE、ALTER、SELECT、INSERT、UPDATE` 等，所有的权限则使用 `ALL` 
- 数据库名.表名 
  - 对哪些数据库的哪些表，如果要取消该用户对所有数据库和表的操作权限则可用\*表 示，如\*.\* 
- '用户名'@'主机名' 
  - 给哪个用户撤销  

```sql
#撤销 user1 用户对 test 数据库所有表的操作的权限 
revoke all on test.* from 'user1'@'localhost'; 
```

### 查看权限

```sql
SHOW GRANTS FOR '用户名'@'主机名'; 
```

```sql
SHOW GRANTS FOR 'root'@'localhost';
```

### 删除用户

```sql
DROP USER '用户名'@'主机名'; 
```

### 修改管理员密码

如果忘了原来的管理员密码

1. `cmd --> net stop mysql` 停止 mysql 服务
   - 需要管理员运行该 cmd
2. 使用无验证方式启动 mysql 服务：`mysqld --skip-grant-tables`
3. 打开新的 cmd 窗口,直接输入 mysql 命令，敲回车。就可以登录成功
4. `use mysql;`
5. `update user set password = password('你的新密码') where user = 'root';`
6. 关闭两个窗口
7. 打开任务管理器，手动结束 mysqld.exe 的进程
8. 启动 mysql 服务
9. 使用新密码登录。

如果记得原来的密码

```sql
mysqladmin -uroot -p password 新密码 #需要在未登陆 MySQL 的情况下操作，新密码不需要加上引号。 
```

### 修改普通用户密码 

```sql
set password for '用户名'@'主机名' = password('新密码'); 
```