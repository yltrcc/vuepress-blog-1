(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{968:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"node-js-提出的背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js-提出的背景"}},[s._v("#")]),s._v(" Node.js 提出的背景")]),s._v(" "),a("h3",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),a("p",[s._v("Node.js 于 2009 年由 Ryan Dahl 提出，它提出 Node.js 是为了解决当时的并发连接问题。以往的编程语言对于请求的处理方式是，来一个请求就新建一个线程来处理这个请求，假设一个线程需要消耗 2MB 的内存资源，那么对于一个 8GB 的内存系统，它最多同时处理 4000 个请求。如果需要处理更多的请求的话，就需要增加更多的服务器，另外由于用户的每个请求可能访问不同的服务器，所以所有的资源都需要在服务器之间共享。这种 Web 架构下瓶颈就在于服务器能够处理的并发连接的最大数量。")]),s._v(" "),a("p",[s._v("Node.js 提出另一种方法来解决这种问题，那就是事件绑定。每次来到一个请求，并不是为该请求新建一个线程，而是为该请求绑定一个事件，并且添加到"),a("strong",[s._v("事件队列")]),s._v("，而最终达到的效果是，使用 Node.js 的服务器能够同时处理数万个并发连接。")]),s._v(" "),a("p",[s._v("如果将服务器比作是一个饭店，而一个请求就是一个客人。对于使用多线程的方式的服务器，来一个客人就派一个服务生去服务客人，直至客人离开。而 Node.js 则是只有一位服务员，这位服务员不会从头到尾都服务客人，每来一个客人，在了解完客人的需求后，并记录下来，就请客人去座位上等待，会有专门的人员去处理记录的需求。")]),s._v(" "),a("p",[s._v("所以 Node.js 也有其适应的场景，它适合于 IO 密集型的任务，而不适合 CPU 密集型的任务。所谓的 IO 密集型任务指的就是像上面所提及的大量的并发请求，而 CPU 密集型任务指的是需要做复杂耗时长的计算的任务。")]),s._v(" "),a("h3",{attrs:{id:"应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用"}},[s._v("#")]),s._v(" 应用")]),s._v(" "),a("p",[s._v("Node.js 自 2009 年提出发展至今已有十余年的时间，虽然 Node.js 当初的想法是为了解决大并发的问题，但是随着十几年的发展，Node.js 也催生出了其他的应用：")]),s._v(" "),a("ul",[a("li",[s._v("Web 服务器：自 Node.js 诞生，提出了很多得 Web 框架，我们可以使用它方便的写出 Web 程序\n"),a("ul",[a("li",[s._v("Express")]),s._v(" "),a("li",[s._v("Koa2")]),s._v(" "),a("li",[s._v("Egg")])])]),s._v(" "),a("li",[s._v("前端工程化：Node.js 的提出，使得前端也产生一次质的飞跃，使用 Node.js 编写的前端工具使得开发前端项目变得简单\n"),a("ul",[a("li",[s._v("Babel")]),s._v(" "),a("li",[s._v("Webpack")]),s._v(" "),a("li",[s._v("Eslint")]),s._v(" "),a("li",[s._v("Jest")])])]),s._v(" "),a("li",[s._v("桌面项目：Node.js 提供了具有访问操作系统 API 的能力，使得使用 Node.js 也可以开发出桌面项目\n"),a("ul",[a("li",[s._v("Electron")])])]),s._v(" "),a("li",[s._v("脚手架工具：使用 Node.js 编写的脚手架工具，让我们可以很快的开始一个前端项目\n"),a("ul",[a("li",[s._v("creat-react-app")]),s._v(" "),a("li",[s._v("vue-cli")])])]),s._v(" "),a("li",[s._v("服务端渲染：\n"),a("ul",[a("li",[s._v("next.js")]),s._v(" "),a("li",[s._v("nuxt.js")])])]),s._v(" "),a("li",[s._v("Serverless")]),s._v(" "),a("li",[s._v("...")])]),s._v(" "),a("h2",{attrs:{id:"模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块"}},[s._v("#")]),s._v(" 模块")]),s._v(" "),a("h3",{attrs:{id:"概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[s._v("#")]),s._v(" 概念")]),s._v(" "),a("p",[s._v("现在的程序越来越复杂，已经不可能将所有的程序写在一个文件里面了，一个是难以阅读，二个是不利于多人协作，所以有必要将代码分割在不同的部分，这些部分就叫做模块。")]),s._v(" "),a("p",[s._v("将代码分割为不同的模块以后，可以有如下好处：")]),s._v(" "),a("ul",[a("li",[s._v("不同的模块负责不同的功能，使得代码阅读起来更加清晰，并且维护起来也会比较简单")]),s._v(" "),a("li",[s._v("不同的模块有各自的作用域，可以避免全局变量发生冲突")]),s._v(" "),a("li",[s._v("利于多人协作，每个人开发属于自己的模块，最后组合为一个大的程序")]),s._v(" "),a("li",[s._v("代码复用，可以将一些与业务无关的工具函数抽离出来，在别的项目中进行复用")])]),s._v(" "),a("p",[s._v("将代码进行分割以后，还需要将代码组合起来，让它们协作得以工作。")]),s._v(" "),a("p",[s._v("要使得模块能够互相协作，就需要模块能够暴露给其他模块访问该模块内部的一些变量，将这些变量暴露给其他函数的行为就是导出；而导入与导出相对，将其他模块暴露出的变量引入到本模块，使得本模块能够访问其他模块暴露出的变量，这个行为就是导入。")]),s._v(" "),a("h3",{attrs:{id:"导出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导出"}},[s._v("#")]),s._v(" 导出")]),s._v(" "),a("p",[s._v("在 Node.js 中，一个 .js 文件就是一个模块，在每个模块中，都有一个 "),a("code",[s._v("module")]),s._v(" 对象，"),a("code",[s._v("module")]),s._v(" 对象有一个 "),a("code",[s._v("exports")]),s._v(" 属性，该属性会被作为该模块的导出内容")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// alice.js")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Alice"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("gender")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"female"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("例如在上面，我们设置 "),a("code",[s._v("module.exports")]),s._v(" 为一个对象，这个对象就是对外暴露的内容，可以在其他模块中导入这个对象并使用。")]),s._v(" "),a("p",[s._v("在每一个模块中，还有一个名为 "),a("code",[s._v("exports")]),s._v(" 的变量，它是 "),a("code",[s._v("module.exports")]),s._v(" 的引用，你可以看做在每个模块的开头都有这么一行代码")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("它的提出是为了简写方便")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// bob.js")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Bob"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" gender "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"male"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gender "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" gender"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("上面我们通过为 "),a("code",[s._v("module.exports")]),s._v(" 的属性赋值，从而将本模块内的几个变量暴露出来给其他模块访问，上面的 "),a("code",[s._v("module.exports")]),s._v(" 通通可以替换为 "),a("code",[s._v("exports")])]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// bob.js")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Bob"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" gender "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"male"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gender "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" gender"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("但是经常有新手有如下错误的写法")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// bob.js")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Bob"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" gender "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"male"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nexports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("gender")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" gender\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("上面通过给 "),a("code",[s._v("exports")]),s._v(" 变量赋值为一个对象，希望将本模块的一些变量导出，但是在其他模块中导入该模块时，发现导入的只是一个空对象，这往往让新手百思不得其解，其实稍加分析就可以知道为什么。")]),s._v(" "),a("p",[s._v("要明白上面的写法为什么是错误的，我先再次强调，"),a("strong",[s._v("模块导出的是 "),a("code",[s._v("module.exports")]),s._v(" 这个变量")]),s._v("，而 "),a("code",[s._v("exports")]),s._v(" 只是一个引用，指向 "),a("code",[s._v("module.exports")]),s._v("。所以当我们通过 "),a("code",[s._v("exports.xxx")]),s._v(" 的方式添加属性时，也就是相当于为 "),a("code",[s._v("module.exports")]),s._v(" 这个对象添加属性，所以被添加的属性可以被导出；但是当我们为 "),a("code",[s._v("exports")]),s._v(" 赋予一个新的值的时候，"),a("code",[s._v("exports")]),s._v(" 不在是 "),a("code",[s._v("module.exports")]),s._v(" 的引用，并且 "),a("code",[s._v("module.exports")]),s._v(" 并不会发生任何的改变，导出的内容也不会如预期那般。")]),s._v(" "),a("ImageView",{staticStyle:{zoom:"25%"},attrs:{src:"https://user-images.githubusercontent.com/29890094/106893281-493cb480-6728-11eb-9746-bf2438cce57c.gif"}}),s._v(" "),a("p",[s._v("如果想直接导出一个对象，请直接使用 "),a("code",[s._v("module.exports")]),s._v("，或者通过 "),a("code",[s._v("exports.xxx")]),s._v(" 的方式一个个的添加属性。")]),s._v(" "),a("blockquote",[a("p",[s._v("如果实在搞不懂 "),a("code",[s._v("exports")]),s._v("，那么请忘了它，影响不大。")])]),s._v(" "),a("h3",{attrs:{id:"导入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入"}},[s._v("#")]),s._v(" 导入")]),s._v(" "),a("p",[s._v("我们使用 require 这个函数来导入其他模块暴露出来的变量")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// index.js")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" alice "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./alice.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("alice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Alice")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("上面我们通过 require 导入了 alice.js 这个模块，其实导入的内容就是 alice.js 中的 module.exports，我们使用变量 alice 进行接收。如果我们并不需要导入模块的所有内容，只是需要其中的某个属性，例如上面我们只是需要 name 这个属性，我们可以使使用 ES6 的解构语法获得需要的属性")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// index.js")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./alice.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Alice")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("当我们导入一个模块的时候，首先会先执行这个模块")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a.js")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//b.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("输出为")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\nb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("注意到，我们可以省略后缀名，当我们省略后缀名时，它将根据下面的顺序查找文件")]),s._v(" "),a("ol",[a("li",[s._v("是否有 a.js 文件，是否有 a.json 文件，是否有 a.node 文件")]),s._v(" "),a("li",[s._v("是否有一个名字为 a 的文件夹，下面有一个 package.json 文件并且有 main 字段，如果有则根据 main 字段指明的路径去加载文件")]),s._v(" "),a("li",[s._v("是否有一个名字为 a 的文件夹，下面有一个 index.js")])]),s._v(" "),a("p",[s._v("如果按照以上顺序都没有找到文件，那么会抛出一个错误。")]),s._v(" "),a("h2",{attrs:{id:"npm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm"}},[s._v("#")]),s._v(" npm")]),s._v(" "),a("p",[s._v("我们在手机上下载软件时，一般都是从应用商店下载软件，不会去某个软件的官网去下载，大家都把软件放在应用商店中，大家只要去商店里面下载即可了。同样，当我们需要用到其他人编写的第三方模块时，我们也希望有一个商店让我们去下载，我们不要去每个官网一个个的下载。")]),s._v(" "),a("p",[s._v("并且程序比软件下载更加的复杂，体现在包的依赖关系。本着不造轮子的原则，很多的程序都是直接使用别人已经写好的代码，所以代码之间可以说有非常复杂的依赖关系。我们可能需要一个 a 包帮我们做事情，但是 a 包又依赖于 b 这个包，b 包又依赖于 c 包，等等。所以为了使得我们的 a 包能够工作，我们还需要下载好 b 包、c 包等等这些被依赖的包。这就会带来问题，例如我们不知道 a 包依赖于什么包，以及即使我们知道 a 包依赖于这些包，一个个的下载这些包是否是一件极其无聊的工作。")]),s._v(" "),a("p",[s._v("基于以上几点，我们迫切需要一个包管理工具帮助我们。在 Node 中，Node Package Manager (npm) 正是用来做到这一点的，我们不仅可以通过它下载需要的包，并且它还会根据包的依赖关系，自动的帮我们下载好其他被依赖的包。")]),s._v(" "),a("p",[s._v("那么包是什么? 比较正式的定义："),a("strong",[s._v("包是一个由 "),a("code",[s._v("package.json")]),s._v(" 定义的文件或目录")]),s._v("。假设有一天，你写了一个有用的工具，希望分享给大家，这个程序肯定不只是一个文件的代码，是多个模块的组合，即你分享的不是一个文件，而是一个文件夹，其中包括了这些模块。")]),s._v(" "),a("p",[s._v("那么 "),a("code",[s._v("package.json")]),s._v(" 又是什么呢? 你可以把它看做是一个配置文件，其中记录了该工具的信息，例如版本，名称，作者等等内容，最重要的是，它记录了你写的工具依赖了哪些其他的第三方模块，这样当别人下载你的包时会根据 "),a("code",[s._v("package.json")]),s._v(" 标注的依赖下载所依赖的包。")]),s._v(" "),a("p",[s._v("那么在 Node.js 中可以直接引入一个文件夹吗? 答案是可以的，Node.js 中的模块可以是如下三种：")]),s._v(" "),a("ul",[a("li",[s._v("一个文件(.js, .json, .node)")]),s._v(" "),a("li",[s._v("一个包含 "),a("code",[s._v("package.json")]),s._v(" 文件并且定义了 "),a("code",[s._v("main")]),s._v(" 字段的文件夹")]),s._v(" "),a("li",[s._v("一个包含 "),a("code",[s._v("index.js")]),s._v(" 的文件夹")])]),s._v(" "),a("p",[s._v("所以，我们可以直接使用 require 导入一个包，它会根据 main 字段指明的地址去加载 .js 文件。")]),s._v(" "),a("h3",{attrs:{id:"npm-init"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-init"}},[s._v("#")]),s._v(" npm init")]),s._v(" "),a("p",[s._v("下载介绍 "),a("code",[s._v("npm")]),s._v(" 在命令行中的使用，当我们下载好了 Node.js，一般都是会自动安装好 "),a("code",[s._v("npm")]),s._v(" 的，我们可以在命令行通过 "),a("code",[s._v("npm --version")]),s._v(" 查看 "),a("code",[s._v("npm")]),s._v(" 的版本号")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("λ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" --version\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.14")]),s._v(".8\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("我们写一个项目，就肯定需要准备一个 "),a("code",[s._v("package.json")]),s._v(" 文件，你可以手动创建该文件，或者通过 "),a("code",[s._v("npm init")]),s._v(" 命令创建一个模板，一般情况下我们都会使用 "),a("code",[s._v("npm init")]),s._v(" 来创建一个 "),a("code",[s._v("package.json")]),s._v(" 文件")]),s._v(" "),a("ImageView",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-images.githubusercontent.com/29890094/106990677-ad568b80-67af-11eb-94e6-df5030160cf1.png"}}),s._v(" "),a("p",[s._v("在我们输入 "),a("code",[s._v("npm init")]),s._v(" 后，它会引导我们创建一个 "),a("code",[s._v("package.json")]),s._v(" 文件，填写一些常见的信息，例如包名、版本、作者等等，当这些都执行完毕后，在目录下回出现一个 "),a("code",[s._v("package.json")]),s._v(" 文件，其内容如下")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Node Demo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"main"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo \\"Error: no test specified\\" && exit 1"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"author"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"XT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"license"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MIT"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("这些内容都是我们在命令行中填写的内容。如果希望快速创建一个 "),a("code",[s._v("package.json")]),s._v(" 文件，所以配置项采用默认配置，我们可以使用 "),a("code",[s._v("npm init -y")]),s._v("，传入 "),a("code",[s._v("-y")]),s._v(" 表示所有的配置项采用默认配置。")]),s._v(" "),a("h3",{attrs:{id:"npm-install"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-install"}},[s._v("#")]),s._v(" npm install")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("npm install")]),s._v(" 可以下载包，下载的包分为三种：")]),s._v(" "),a("ul",[a("li",[s._v("全局安装")]),s._v(" "),a("li",[s._v("本地安装\n"),a("ul",[a("li",[s._v("本地依赖")]),s._v(" "),a("li",[s._v("开发依赖")])])])]),s._v(" "),a("p",[s._v("不同依赖的包在下载时需要传入不同的参数。")]),s._v(" "),a("h4",{attrs:{id:"全局安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局安装"}},[s._v("#")]),s._v(" 全局安装")]),s._v(" "),a("p",[s._v("全局安装的包可以在命令行直接执行，对于需要全局依赖的包，我们要传入 "),a("code",[s._v("--global")]),s._v(" 参数或者 "),a("code",[s._v("-g")]),s._v(" 参数，例如我们下载一个 "),a("code",[s._v("nrm")]),s._v(" 的包，这个包是用来设置镜像源的，因为 "),a("code",[s._v("npm")]),s._v(" 的服务器在国外，下载速度很慢，所以我们需要设置 "),a("code",[s._v("npm")]),s._v(" 下载的镜像源")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g nrm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ImageView",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-images.githubusercontent.com/29890094/107120136-cc940c80-68c6-11eb-8b0a-94c0a634df9d.png"}}),s._v(" "),a("p",[s._v("它会将这个包下载到 "),a("code",[s._v("C:\\Users\\username\\AppData\\Roaming\\npm\\node_modules")]),s._v(" 这个文件夹下面，并且会在 "),a("code",[s._v("C:\\Users\\username\\AppData\\Roaming\\npm\\")]),s._v(" 生成对应的 .cmd 文件，例如当我们全局安装 nrm 之后就会在 npm 文件夹下生成 nrm.cmd 文件")]),s._v(" "),a("ImageView",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-images.githubusercontent.com/29890094/107135256-0b13e080-6934-11eb-9f41-ae7d18ce6097.png"}}),s._v(" "),a("p",[s._v("因为 "),a("code",[s._v("C:\\Users\\username\\AppData\\Roaming\\npm\\")]),s._v(" 这个文件夹在安装 "),a("code",[s._v("npm")]),s._v(" 的时候就会被自动的添加到环境变量中，当我们在命令行输入 "),a("code",[s._v("nrm")]),s._v(" 的时候，它就会在这个路径搜索 "),a("code",[s._v("nrm")]),s._v(" 命令，然后执行，这就是全局安装的包能够在命令行直接执行的原因。")]),s._v(" "),a("p",[s._v("我们在命令行输入")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("nrm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("它会显示出有哪些可用的镜像源")]),s._v(" "),a("ImageView",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-images.githubusercontent.com/29890094/107135518-63e47880-6936-11eb-9957-5923a11da34f.png"}}),s._v(" "),a("p",[s._v("我们一般选择 taobao 或者 cnpm 镜像源，通过 "),a("code",[s._v("nrm use 镜像源")]),s._v("的方式选择镜像源")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("nrm use taobao\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ImageView",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-images.githubusercontent.com/29890094/107135564-c0479800-6936-11eb-9d37-1423a1cb00de.png"}}),s._v(" "),a("blockquote",[a("p",[s._v("这里讲述我遇到的一个坑，我之前是下载好 "),a("code",[s._v("nrm")]),s._v(" 的，为了演示我把之前下载好的 "),a("code",[s._v("nrm")]),s._v(" 卸载掉，然后重新装了一遍，装了一遍之后发现 "),a("code",[s._v("nrm")]),s._v(" 不好使了，开始报错")]),s._v(" "),a("ImageView",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-images.githubusercontent.com/29890094/107135659-83c86c00-6937-11eb-8939-a678f976a99d.png"}}),s._v(" "),a("p",[s._v("咱也不知道为啥，错误提示也看不懂，就去上网搜，说要改变 cli.js("),a("code",[s._v("C:\\Users\\username\\AppData\\Roaming\\npm\\node_modules\\nrm\\cli.js")]),s._v(") 的第 17 行")]),s._v(" "),a("ImageView",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-images.githubusercontent.com/29890094/107135698-cc802500-6937-11eb-8bf4-1d12be1a1365.png"}}),s._v(" "),a("p",[s._v("上面的一行是原来第 17 行的内容，后面一行是修改后的内容，贴在下面")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NRMRC")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("platform "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'win32'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'USERPROFILE'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'HOME'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.nrmrc'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果你也遇到了这个问题，按照上面的方法改吧，亲测有效。")])],1),s._v(" "),a("h4",{attrs:{id:"本地安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地安装"}},[s._v("#")]),s._v(" 本地安装")]),s._v(" "),a("p",[s._v("通过上面的分类我们可以看到，本地安装也分为两类，一种是开发依赖，意思就是仅仅在开发的时候才依赖的包，上线之后这个包就不需要了。例如压缩文件，这个包在编译的时候需要，但是在生产环境下，我们就使用这个压缩好的文件，就不需要压缩文件了，所以这个压缩文件的包只在开发(编译)时需要。另一种本地依赖的包是只在本地开发时以及上线后都需要依赖的包，比如在程序中依赖的一些库。")]),s._v(" "),a("p",[s._v("当我们下载开发时依赖的包时，需要传入 "),a("code",[s._v("--save-dev")]),s._v(" 或者 "),a("code",[s._v("-D")]),s._v(" 参数，当我们下载本地依赖的包时，传入 "),a("code",[s._v("--save")]),s._v(" 或者 "),a("code",[s._v("-S")]),s._v(" 参数，也可以不传，不传的情况下默认是本地依赖。")]),s._v(" "),a("p",[s._v("我们随便下载两个包")]),s._v(" "),a("ImageView",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-images.githubusercontent.com/29890094/107135951-fcc8c300-6939-11eb-8bdf-a6d7c6311d43.png"}}),s._v(" "),a("p",[s._v("我们再查看 "),a("code",[s._v("package.json")]),s._v(" 文件")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Node Demo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"main"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo \\"Error: no test specified\\" && exit 1"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"author"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"XT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"license"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MIT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"webpack"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^5.21.1"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"devDependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"ora"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^5.3.0"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("发现多了 "),a("code",[s._v("dependencies")]),s._v(" 以及 "),a("code",[s._v("devDependencies")]),s._v(" 两个属性，"),a("code",[s._v("dependencies")]),s._v(" 中的属性是本地依赖的包，以及对于的版本号，而 "),a("code",[s._v("devDependencies")]),s._v(" 中的属性是开发时依赖的包，以及对应的版本号。")]),s._v(" "),a("blockquote",[a("p",[s._v("细心的话，还会发现多了一个 "),a("code",[s._v("package-lock.json")]),s._v(" 文件，里面不仅给定了当前项目的依赖，例如上面安装的 webpack 以及 ora，还给定了依赖的依赖以及它们的版本号，就是 webpack 以及 ora 它们所依赖的包。")]),s._v(" "),a("p",[s._v("所以为什么需要 "),a("code",[s._v("package-lock.json")]),s._v(" 文件? 要明白为什么需要这个文件，就需要明白它的作用是什么。它的作用是为了锁定版本号的，例如上面我们安装 webpack 对于的版本号为 "),a("code",[s._v("^5.21.1")]),s._v("，其中 "),a("code",[s._v("^")]),s._v(" 表示向后兼容，所以如果没有 "),a("code",[s._v("package-lock.json")]),s._v("，实际安装的版本号可能是最新的版本，比 "),a("code",[s._v("5.21.1")]),s._v(" 的版本要高，这就可能会因为版本的不一致导致各种问题(我遇到过很多次)，所以需要一个 "),a("code",[s._v("package-lock.json")]),s._v(" 来记录具体的版本号。")])]),s._v(" "),a("p",[s._v("这时我们甚至可以将 node_modules 这个文件夹给删掉，然后运行 "),a("code",[s._v("npm install")]),s._v(" 即可将所依赖的包给安装回来，所以很多时候我们从 Github 上下载项目时，会发现没有 node_modules 文件夹，它要你在本地先运行 "),a("code",[s._v("npm install")]),s._v(" 命令，将 "),a("code",[s._v("package.json")]),s._v(" 中描述所依赖的包下载下来，然后在启动项目。")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("npm install")]),s._v(" 是根据 "),a("code",[s._v("package.json")]),s._v(" 文件还是 "),a("code",[s._v("package-lock.json")]),s._v(" 文件进行安装包的呢? 这个问题你在网上搜可能会得到不同的结论，这是因为安装策略有过三次调整：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("npm 5.0.x 版本，"),a("code",[s._v("npm install")]),s._v(" 根据 "),a("code",[s._v("package-lock.json")]),s._v(" 文件下载")]),s._v(" "),a("ul",[a("li",[s._v("然后被控诉为什么改了 "),a("code",[s._v("package.json")]),s._v(" 文件，为啥不给我升级包")])])]),s._v(" "),a("li",[a("p",[s._v("npm 5.1.0 版本后，忽略 "),a("code",[s._v("package-lock.json")]),s._v(" 文件，只根据 "),a("code",[s._v("package.json")]),s._v(" 文件下载")]),s._v(" "),a("ul",[a("li",[s._v("那 "),a("code",[s._v("package-lock.json")]),s._v(" 文件有什么用")])])]),s._v(" "),a("li",[a("p",[s._v("npm 5.4.2 版本后")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("如果 "),a("code",[s._v("package-lock.json")]),s._v(" 与 "),a("code",[s._v("package.json")]),s._v(" 描述的版本号不同(为什么会不同，因为手动改了 "),a("code",[s._v("package.json")]),s._v(" 文件)，那么根据 "),a("code",[s._v("package.json")]),s._v(" 版本进行下载，并且更新 "),a("code",[s._v("package-lock.json")]),s._v(" 文件")])]),s._v(" "),a("li",[a("p",[s._v("如果相同，那么根据 "),a("code",[s._v("package-lock.json")]),s._v(" 进行下载，不必理会 "),a("code",[s._v("package.json")]),s._v(" 中依赖的包是否有更新")])])])])])]),s._v(" "),a("p",[s._v("与 "),a("code",[s._v("npm install")]),s._v(" 相对的是 "),a("code",[s._v("npm uninstall")]),s._v(" 命令，是用来卸载包的，例如")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" uninstall webpack --save\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"npm-scripts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-scripts"}},[s._v("#")]),s._v(" npm  scripts")]),s._v(" "),a("p",[s._v("在 package.json 中有一个 scripts 字段，它是一个对象，它的每一个属性都对应一个脚本")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node build.js"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("当我们在当前项目的下输入")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("就相当于运行了")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" build.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这些定义在 package.json 里面的脚本，我们称之为 npm scripts。")]),s._v(" "),a("p",[s._v("使用 npm scripts 有如下优点：")]),s._v(" "),a("ul",[a("li",[s._v("项目中的脚本集中放置在一处")]),s._v(" "),a("li",[s._v("不同的项目可能有不同的构建命令，但是可以通过 npm scripts 向外提供统一的接口，如 "),a("code",[s._v("npm run build")])])]),s._v(" "),a("h2",{attrs:{id:"深入模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#深入模块"}},[s._v("#")]),s._v(" 深入模块")]),s._v(" "),a("h3",{attrs:{id:"导入路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入路径"}},[s._v("#")]),s._v(" 导入路径")]),s._v(" "),a("p",[s._v("当我们导入其他模块时，可以指定模块的具体路径，例如 "),a("code",[s._v("./a.js")]),s._v("，通过相对路径或者绝对路径均可，但是如果我们没有指定路径，如 "),a("code",[s._v("require('a')")]),s._v("，会以何种方式去搜寻该包。")]),s._v(" "),a("p",[s._v("我们可以通过 module.paths 这个属性查看搜索的路径")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// D:\\Desktop\\node-demo\\a.js")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("paths"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("输出为")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d:\\\\Desktop\\\\node-demo\\\\node_modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d:\\\\Desktop\\\\node_modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d:\\\\node_modules'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("可见它会先搜索文件所在目录下的 node_modules 文件夹，如果搜索不到则搜索上级目录的 node_modules 文件夹，直至根目录的 node_modules 文件夹，如果在这些路径都没有找到指定的包，那么就会抛出一个错误。")]),s._v(" "),a("h3",{attrs:{id:"缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存"}},[s._v("#")]),s._v(" 缓存")]),s._v(" "),a("p",[s._v("在导入部分我们说过，当我们导入一个模块时，首先会执行这个模块，在实际的项目中肯定会有多个模块依赖于一个模块的情形，这是不是说每次导入这个模块时，这个模块都会被执行一次? 明显这样不对，所以其实这个模块只会执行一次，然后它的 module.exports 属性就会被缓存，如果第二次、第三次导入这个模块时，直接将缓存的 module.exports 属性返回即可，不必再次执行一次这个模块。")]),s._v(" "),a("p",[s._v("通过 require.cache 这个属性可以知道有哪些 module 对象被缓存起来了，require.cache 是一个对象，其键值是模块的绝对地址，值为 module 对象，在我们 require 模块的时候，如果在 require.cache 对象发现这个模块已经被加载过，那么直接返回这个模块即可，而不必再次执行这个模块。")]),s._v(" "),a("h3",{attrs:{id:"主程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主程序"}},[s._v("#")]),s._v(" 主程序")]),s._v(" "),a("p",[s._v("一个模块被执行有两种情况：")]),s._v(" "),a("ul",[a("li",[s._v("通过 node 命令直接执行该模块")]),s._v(" "),a("li",[s._v("被其他模块导入")])]),s._v(" "),a("p",[s._v("通过 node 命令执行的模块我们称之为主模块，有时候我们希望根据模块是否是主模块来表现不同的行为，所以我们需要一种方法来分辨该模块是不是主模块，我们可以通过 require.main 属性来判断一个模块是不是主模块，如果 require.main 的值与当前模块的 module 对象相同，就说明当前模块时主模块")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("main "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"主模块"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"非主模块"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"循环引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#循环引用"}},[s._v("#")]),s._v(" 循环引用")]),s._v(" "),a("p",[s._v("最后我们要探讨一下，Node.js 对模块的循环引用如何解决，所谓的循环引用就是指二者互相引用")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./b.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//b.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./a.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("如上 "),a("code",[s._v("a.js")]),s._v(" 与 "),a("code",[s._v("b.js")]),s._v(" 互相引用，我们称之为循环引用，那这样会不会形成死循环，程序如何能执行下去。")]),s._v(" "),a("p",[s._v("解释这个问题很简单，只需要牢牢的抓住缓存即可，因为有缓存的存在，并不会无限的去执行文件导入，而是直接去缓存中的值。假设有如下的程序")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a.js")]),s._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" b "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./b.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b.done: "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// true")]),s._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// b.js")]),s._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./a.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a.done: "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// false")]),s._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// index.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./a.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" b "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./b.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a.done: "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// true")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b.done: "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("我们执行 index.js，执行过程如下：")]),s._v(" "),a("ol",[a("li",[s._v("执行 index.js，导入 a.js\n"),a("ol",[a("li",[s._v("执行 a.js，并缓存 a.js 的 module.exports")]),s._v(" "),a("li",[s._v("设置 exports.done 为 false")]),s._v(" "),a("li",[s._v("导入 b.js\n"),a("ol",[a("li",[s._v("执行 b.js，并缓存 b.js 模块")]),s._v(" "),a("li",[s._v("在 b.js 中导入 a.js，"),a("strong",[s._v("此时因为 a.js 这个模块已经被缓存，所以取缓存即可")])]),s._v(" "),a("li",[s._v("因为 a.js 模块此时的 done 属性为 fasle，所以打印的结果为 false")])])]),s._v(" "),a("li",[s._v("回到 a.js，取到 b.js 模块导出的module.exports，这个对象的 done 属性为 true，因此打印结果为 true")])])]),s._v(" "),a("li",[s._v("回到 index.js，导入 b.js 模块，该模块已经被缓存，直接取缓存结果")]),s._v(" "),a("li",[s._v("此时 a.js 与 b.js 中的 exports.done 属性均为 true，打印结果均为true")])]),s._v(" "),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://developer.ibm.com/zh/articles/os-nodejs/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node.js 究竟是什么"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://loveky.github.io/2019/02/12/nodejs-module-system/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node.js 的模块系统"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://itbilu.com/nodejs/npm/N1hHQ2xk-.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node.js 中的包和模块"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://ithelp.ithome.com.tw/articles/10191783",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm install 到底做了什么"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000015218126",target:"_blank",rel:"noopener noreferrer"}},[s._v("通过 npm 制作命令行工具的原理"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/S_aitama/article/details/113706339",target:"_blank",rel:"noopener noreferrer"}},[s._v("nrm 报错 [ERR_INVALID_ARG_TYPE] 解决方法"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.zhihu.com/question/62331583",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm install 生成的 package-lock.json 是什么文件? 有什么用?"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2016/10/npm_scripts.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm scripts 使用指南"),a("OutboundLink")],1)])])],1)}),[],!1,null,null,null);t.default=e.exports}}]);